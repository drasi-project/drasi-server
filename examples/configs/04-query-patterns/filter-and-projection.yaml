# Copyright 2025 The Drasi Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# =============================================================================
# Query Patterns - Filtering and Projection
# =============================================================================
#
# This example demonstrates common Cypher query patterns for:
# - Filtering data with WHERE clauses
# - Projecting specific fields with RETURN
# - Using comparison operators
# - String matching and patterns
#
# Cypher supports these comparison operators:
# - Equality: =, <>
# - Comparison: <, <=, >, >=
# - Null checks: IS NULL, IS NOT NULL
# - String: STARTS WITH, ENDS WITH, CONTAINS
# - List: IN
#
# Run with: cargo run -- --config examples/configs/04-query-patterns/filter-and-projection.yaml

id: filter-projection-demo
host: "0.0.0.0"
port: 8080
logLevel: info
persistConfig: false

sources:
  # Generic mock data: value (int), message (string), timestamp
  - kind: mock
    id: data-source
    autoStart: true
    dataType:
      type: generic
    intervalMs: 2000

queries:
  # Working example: Numeric comparison with mock data
  - id: positive-values
    autoStart: true
    query: |
      MATCH (g:Generic)
      WHERE g.value > 0
      RETURN g.value AS Value, g.message AS Message, g.timestamp AS Timestamp
    queryLanguage: Cypher
    sources:
      - sourceId: data-source

  # Working example: Negative value filter
  - id: negative-values
    autoStart: true
    query: |
      MATCH (g:Generic)
      WHERE g.value < 0
      RETURN g.value AS Value, g.timestamp AS Timestamp
    queryLanguage: Cypher
    sources:
      - sourceId: data-source

  # Working example: String pattern matching
  - id: message-pattern
    autoStart: true
    query: |
      MATCH (g:Generic)
      WHERE g.message CONTAINS 'mock'
      RETURN g.value AS Value, g.message AS Message
    queryLanguage: Cypher
    sources:
      - sourceId: data-source

  # Working example: All values (no filter)
  - id: all-values
    autoStart: true
    query: |
      MATCH (g:Generic)
      RETURN g.value AS Value, g.message AS Message
    queryLanguage: Cypher
    sources:
      - sourceId: data-source

reactions:
  - kind: log
    id: query-results
    queries:
      - positive-values
      - negative-values
      - message-pattern
      - all-values
    autoStart: true
    routes:
      positive-values:
        added:
          template: "[positive] Value={{after.Value}} at {{after.Timestamp}}"
      negative-values:
        added:
          template: "[negative] Value={{after.Value}} at {{after.Timestamp}}"
      message-pattern:
        added:
          template: "[pattern] Matched: {{after.Message}} (value={{after.Value}})"
      all-values:
        added:
          template: "[all] Value={{after.Value}} Message={{after.Message}}"
