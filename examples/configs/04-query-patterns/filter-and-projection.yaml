# Copyright 2025 The Drasi Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# =============================================================================
# Query Patterns - Filtering and Projection
# =============================================================================
#
# This example demonstrates common Cypher query patterns for:
# - Filtering data with WHERE clauses
# - Projecting specific fields with RETURN
# - Using comparison operators
# - String matching and patterns
#
# Cypher supports these comparison operators:
# - Equality: =, <>
# - Comparison: <, <=, >, >=
# - Null checks: IS NULL, IS NOT NULL
# - String: STARTS WITH, ENDS WITH, CONTAINS
# - List: IN
#
# Run with: cargo run -- --config examples/configs/04-query-patterns/filter-and-projection.yaml

id: filter-projection-demo
host: "0.0.0.0"
port: 8080
logLevel: info
persistConfig: false

sources:
  - kind: mock
    id: data-source
    autoStart: true
    dataType: "generic"
    intervalMs: 2000

queries:
  # Basic equality filter
  - id: exact-match
    autoStart: true
    query: |
      MATCH (p:Product)
      WHERE p.category = 'electronics'
      RETURN p.id AS ProductId, p.name AS Name, p.price AS Price
    sources:
      - sourceId: data-source

  # Numeric comparison
  - id: price-range
    autoStart: true
    query: |
      MATCH (p:Product)
      WHERE p.price >= 100 AND p.price <= 500
      RETURN p.id AS ProductId, p.name AS Name, p.price AS Price
    sources:
      - sourceId: data-source

  # String pattern matching
  - id: name-pattern
    autoStart: true
    query: |
      MATCH (p:Product)
      WHERE p.name STARTS WITH 'Pro'
      RETURN p.id AS ProductId, p.name AS Name
    sources:
      - sourceId: data-source

  # Multiple conditions with OR
  - id: priority-items
    autoStart: true
    query: |
      MATCH (i:Item)
      WHERE i.priority = 'high' OR i.quantity < 5
      RETURN i.id AS ItemId, i.priority AS Priority, i.quantity AS Quantity
    sources:
      - sourceId: data-source

  # Projection with computed fields
  - id: calculated-fields
    autoStart: true
    query: |
      MATCH (o:Order)
      RETURN o.id AS OrderId,
             o.quantity AS Qty,
             o.unit_price AS UnitPrice,
             o.quantity * o.unit_price AS TotalPrice
    sources:
      - sourceId: data-source

  # Distinct values
  - id: unique-categories
    autoStart: true
    query: |
      MATCH (p:Product)
      RETURN DISTINCT p.category AS Category
    sources:
      - sourceId: data-source

reactions:
  - kind: log
    id: query-results
    queries:
      - exact-match
      - price-range
      - name-pattern
      - priority-items
      - calculated-fields
      - unique-categories
    autoStart: true
    defaultTemplate:
      added:
        template: "[{{query_name}}] {{after}}"
      updated:
        template: "[{{query_name}}] Updated: {{after}}"
