# Copyright 2025 The Drasi Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# =============================================================================
# Profiler Reaction - Performance Analysis
# =============================================================================
#
# The profiler reaction measures and reports query performance metrics.
# Use this for:
# - Understanding query execution characteristics
# - Identifying performance bottlenecks
# - Capacity planning
# - Performance regression testing
#
# Configuration options:
# - window_size: Number of samples in the observation window (default: 100)
# - report_interval_secs: Seconds between performance reports (default: 60)
#
# The profiler tracks:
# - Event throughput (events/second)
# - Processing latency
# - Memory usage patterns
# - Query execution statistics
#
# Run with: cargo run -- --config examples/configs/03-reactions/profiler-performance.yaml
#
# View performance reports in the console output.

id: profiler-demo
host: "0.0.0.0"
port: 8080
logLevel: info
persistConfig: false

sources:
  # Fast-generating source for performance testing
  - kind: mock
    id: high-volume
    autoStart: true
    dataType: "generic"
    intervalMs: 100

queries:
  # Simple pass-through query
  - id: simple-query
    autoStart: true
    query: |
      MATCH (n)
      RETURN n
    sources:
      - sourceId: high-volume

  # Filtered query
  - id: filtered-query
    autoStart: true
    query: |
      MATCH (n)
      WHERE n.value > 50
      RETURN n.id, n.value
    sources:
      - sourceId: high-volume

  # Aggregation query (more compute intensive)
  - id: aggregation-query
    autoStart: true
    query: |
      MATCH (n)
      RETURN count(n) AS Count, avg(n.value) AS Average
    sources:
      - sourceId: high-volume

reactions:
  # Profiler reaction for performance analysis
  - kind: profiler
    id: performance-profiler
    queries:
      - simple-query
      - filtered-query
      - aggregation-query
    autoStart: true
    windowSize: 200
    reportIntervalSecs: 30

  # Optional: Log reaction to see actual results
  - kind: log
    id: sample-output
    queries:
      - aggregation-query
    autoStart: true
    defaultTemplate:
      updated:
        template: "[STATS] {{after}}"
