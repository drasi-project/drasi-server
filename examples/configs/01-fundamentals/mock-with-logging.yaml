# Copyright 2025 The Drasi Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# =============================================================================
# Mock Source with Custom Logging Templates
# =============================================================================
#
# This example demonstrates:
# - Mock source configuration with custom data type and interval
# - Log reaction with Handlebars templates for formatting output
# - Separate templates for added, updated, and deleted events
#
# Run with: cargo run -- --config examples/configs/01-fundamentals/mock-with-logging.yaml
#
# Template variables available:
# - {{query_name}} - The name of the query that produced the result
# - {{before}} - The previous state of the record (for updates/deletes)
# - {{after}} - The new state of the record (for adds/updates)
# - Access fields with dot notation: {{after.FieldName}}

apiVersion: drasi.io/v1
id: mock-logging-demo
host: "0.0.0.0"
port: 8080
logLevel: info
persistConfig: false

sources:
  # Generic mock data generates nodes with: value (int), message (string), timestamp
  - kind: mock
    id: data-generator
    autoStart: true
    dataType:
      type: generic
    intervalMs: 3000

queries:
  - id: track-all-changes
    autoStart: true
    query: |
      MATCH (n:Generic)
      RETURN n.value AS Value, n.message AS Message, n.timestamp AS Timestamp
    queryLanguage: Cypher
    sources:
      - sourceId: data-generator

reactions:
  - kind: log
    id: formatted-logger
    queries:
      - track-all-changes
    autoStart: true
    # Custom templates for different event types
    # Access query result fields with dot notation: {{after.FieldName}}
    defaultTemplate:
      added:
        template: "[ADD] {{query_name}} | Value: {{after.Value}} | Message: {{after.Message}}"
      updated:
        template: "[UPDATE] {{query_name}} | Value: {{after.Value}} (was {{before.Value}})"
      deleted:
        template: "[DELETE] {{query_name}} | Removed value: {{before.Value}}"
